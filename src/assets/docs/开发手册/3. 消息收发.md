# 1、消息收发
## 1.1、消息接收
通过[`addEventListener(event, callback)`]()方法可以注册新消息事件，当有新消息推送过来时，就会触发回调函数。开发者可以自主选择对消息包体进行预处理和ui展示。如：

```
window.SIM.addEventListener('msg', (msg) => {
	console.log('新消息: ', msg);
});
```

## 1.2、消息发送
SIM通过[`sendMsg(msg, onSuccess, onFail)`]()方法发送各种类型消息（文字、表情、图片、视频等）。
msg对象主要属性如下：

| 属性  | 类型 | 是否必须 | 备注 |
| --- | :--- | :---: | ---: |
| type  | string | 是 | 消息类型，0-文本，1-图片，3-视频 |
| message  | string | 是 | 消息内容，根据类型不同不同 |
| receiver  | string | 是 | 接收者id |
| chatType  | number | 是 | 会话类型，0-个人，1-群 |
| id  | string | 否 | 消息id，标示消息的唯一性。可自动生成，sendMsg函数返回 |
| time  | number | 否 | 消息发送时间，可自动生成 |

### 1.2.1、文本消息
简单的文本消息如下：

```
// 创建消息对象
let msg = {
	type: 0,
 	message:  {
		text: '文本测试消息001', // 文本内容
	}
	receiver: '10000', // 接收者id
	chatType: 0, // 会话类型
}
// 发送消息
window.SIM.sendMsg(msg, (e) => {
	console.log('sendMsg end', e);
}, (err) => {
	console.log('sendMsg err', err);
});
```
****文本消息最大5000字符***
### 1.2.2、表情消息
简单的表情消息实现方法：在文本消息的文本内容中加入自定义编码，接收方收到渲染时替换成图片。如下：

```
// 发送方10000
// 创建消息对象
let msg = {
	type: 0,
 	message:  {
		text: '表情测试[微笑][微笑]', // 文本内容
	}
	receiver: '10001', // 接收者id
	chatType: 0, // 会话类型
}
// 发送消息
window.SIM.sendMsg(msg, (e) => {
	console.log('sendMsg end', e);
}, (err) => {
	console.log('sendMsg err', err);
});
...
// 接收方10001
// 收到的消息类似下面结构
newMsg = {
	type: 0,
 	message:  {
		text: '表情测试[微笑][微笑]',
	}
	sender: '10000', // 发送者id
	chatType: 0, // 会话类型
	...
}
let html = newMsg.message.text.replace(/[微笑]/g, '<img src="./img/微笑.jpg">'); // 将事先约定编码替换成表情图片
document.getElementById('msg-00001').innerHTML = html; // 渲染时使用替换后的内容
```

### 1.2.3、图片消息
图片消息如下：

```
// 图片消息体
let msg = {
 	type: 1,
	message:  { // message具体属性可以从uploadImg()接口成功回调获取
	format: 0, // 图片类型
	imageList: [{ // 图片信息列表
			type: 0, // 原图
			url: 'http://ctdfs.geely.com/...', // 图片地址
			size: 100000, // 大小（字节）
			height: 1000, // 高
			width: 1000, // 宽
		}, {
			type: 1, // 大图
			url: 'http://ctdfs.geely.com/...', // 图片地址
			size: 10000, // 大小（字节）
			height: 720, // 高
			width: 720, // 宽
		}, {
			type: 2, // 缩略图
			url: 'http://ctdfs.geely.com/...', // 图片地址
			size: 1000, // 大小（字节）
			height: 198, // 高
			width: 198, // 宽
		}],
	},
	receiver: '10001', // 接收者id
	chatType: 0, // 会话类型
}
// 发送消息
window.SIM.sendMsg(msg, (e) => {
	console.log('sendMsg end', e);
}, (err) => {
	console.log('sendMsg err', err);
});
```

### 1.2.4、视频消息
视频消息如下：

```
// 视频消息体
let msg = {
	type: 3,
	message: { // 视频信息结构
		format: 0, // 格式
		size: 100, // 大小，单位：字节
		filename: 'test.mp4', // 文件名
		downUrl: 'http://ctdfs.geely.com/...', // 下载地址
	},
	receiver: '10001', // 接收者id
	chatType: 0, // 会话类型
}
// 发送消息
window.SIM.sendMsg(msg, (e) => {
	console.log('sendMsg end', e);
}, (err) => {
	console.log('sendMsg err', err);
});
```

## 1.3、消息删除
可以通过[`SIM.deleteMsg(msg, onSuccess, onFail)`]()接口删除指定消息。如：

```
window.SIM.deleteMsg(msgInfo, (e) => {
	console.log('msg end', e);
}, (err) => {
	console.log('msg err', err);
});
```
msgInfo属性表：

| 属性  | 类型 | 是否必须 | 备注 |
| --- | :--- | :---: | ---: |
| id  | string | 是 | 消息id |
| receiver  | string | 是 | 接收者id |
| chatType  | number | 是 | 会话类型，0-个人，1-群 |
| delType  | number | 否 | 删除类型，0-删除自己的，1-删除所有人。默认值：0 |
****SIM中的消息删除分为两种，1种为删除后自己不可见，1种为删除后所有人不可见。通过设置`delType`属性选择***

# 2、群组消息
群组消息与个人消息类似，通过消息对象中的`chatType`区分。